<!--<template>
    <div class="patient-container">
        <div class="slds-form-element">
            <label class="slds-form-element__label" for="patientSearch">Patient Name</label>
            <div class="slds-form-element__control slds-input-has-icon slds-input-has-icon_right">
                <lightning-icon
                    icon-name="utility:search"
                    size="x-small"
                    class="slds-input__icon slds-input__icon_right slds-icon-text-default"
                ></lightning-icon>
                <input
                    type="text"
                    id="patientSearch"
                    class="slds-input"
                    placeholder="Search Patient..."
                    value={searchKey}
                    oninput={handleSearchChange}
                />
            </div>
        </div>

         Lista de resultados 
      <template for:each={patients} for:item="patient">
  <div key={patient.Id}>
    <button
      class="slds-button slds-text-link slds-p-vertical_x-small slds-border_bottom slds-text-body_regular"
      data-id={patient.Id}
      data-name={patient.Name}
      onclick={handleSelect}
    >
      {patient.Name}
    </button>
  </div>
</template>


         Spinner visible durante la carga 
        <template if:true={showLoading}>
            <div class="slds-p-top_x-small">
                <lightning-spinner alternative-text="Loading Patient..." size="small"></lightning-spinner>
            </div>
        </template>
    </div>
</template>  -->



<!-- <template>
  <div class="patient-container">
    <div class="slds-form-element">
      <label class="slds-form-element__label" for="patientSearch">Patient Name</label>

       Lookup combobox 
      <div
        class={comboboxClass}
        aria-expanded={isDropdownOpen}
        aria-haspopup="listbox"
        role="combobox"
      >
        <div
          class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right"
          role="none"
        >
        <div class="slds-form-element__control slds-input-has-icon slds-input-has-icon_left">
  <lightning-icon 
      icon-name="standard:contact" 
      size="x-small"
      class="slds-icon slds-input__icon slds-input__icon_left slds-icon-text-default">
  </lightning-icon>
          <input
            type="text"
            id="patientSearch"
            class="slds-input slds-combobox__input"
            placeholder="Search Patient..."
            value={searchKey}
            oninput={handleSearchChange}
            onfocus={handleFocus}
            onblur={handleBlur}
            aria-autocomplete="list"
            aria-controls="patient-listbox"
          />
          </div>
          <span
            class="slds-icon_container slds-icon-utility-search slds-input__icon slds-input__icon_right"
          >
            <lightning-icon icon-name="utility:search" size="x-small"></lightning-icon>
          </span>
        </div>

         Dropdown de resultados 
        <div
          if:true={isDropdownOpen}
          id="patient-listbox"
          class="slds-dropdown slds-dropdown_length-5 slds-dropdown_fluid"
          role="listbox"
        >
          <ul class="slds-listbox slds-listbox_vertical" role="presentation">
            <template if:true={patients.length}>
              <template for:each={patients} for:item="patient">
                <li key={patient.Id} role="presentation" class="slds-listbox__item">
                  <div
                    class="slds-media slds-listbox__option slds-listbox__option_entity slds-listbox__option_has-meta"
                    role="option"
                    data-id={patient.Id}
                    data-name={patient.Name}
                    onclick={handleSelect}
                  >
                    <span class="slds-media__figure slds-listbox__option-icon">
                      <lightning-icon
                        icon-name="standard:contact"
                        size="small"
                      ></lightning-icon>
                    </span>
                    <span class="slds-media__body">
                      <span
                        class="slds-listbox__option-text slds-listbox__option-text_entity"
                      >
                        {patient.Name}
                      </span>
                      <span class="slds-listbox__option-meta">{patient.Email}</span>
                    </span>
                  </div>
                </li>
              </template>
            </template>

             Sin resultados 
            <template if:false={patients.length}>
              <li class="slds-listbox__item">
                <span class="slds-text-color_weak slds-p-around_x-small">
                  No results found
                </span>
              </li>
            </template>
          </ul>
        </div>
      </div>
    </div>

     Spinner visible durante la carga 
    <template if:true={showLoading}>
      <div class="slds-p-top_x-small">
        <lightning-spinner
          alternative-text="Loading Patient..."
          size="small"
        ></lightning-spinner>
      </div>
    </template>
  </div>
</template> -->


<!--<template>
  <div class="patient-container">
    <div class="slds-form-element">
      <label class="slds-form-element__label" for="patientSearch">Patient Name</label>

      üß© Wrapper que define correctamente el contexto de iconos 
      <div
        class={comboboxClass}
        aria-expanded={isDropdownOpen}
        aria-haspopup="listbox"
        role="combobox"
      >
         üëá Este div debe tener ambas clases directamente 
        <div
          class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_left-right"
          role="none"
        >
           üë§ Icono fijo a la izquierda 
          <lightning-icon
            icon-name="standard:contact"
            size="x-small"
            class="slds-input__icon slds-input__icon_left slds-icon-text-default"
          ></lightning-icon>

          üî§ Input 
          <input
            type="text"
            id="patientSearch"
            class="slds-input slds-combobox__input"
            placeholder="Search Patient..."
            value={searchKey}
            oninput={handleSearchChange}
            onfocus={handleFocus}
            onblur={handleBlur}
            aria-autocomplete="list"
            aria-controls="patient-listbox"
          />

          üîÅ Icono din√°mico a la derecha 
<template if:true={isInputFilled}>
  <button
    class="slds-button slds-button_icon slds-input__icon slds-input__icon_right"
    title="Clear selection"
    onclick={clearSelection}
    type="button"
  >
    <lightning-icon
      icon-name="utility:close"
      size="x-small"
      class="slds-icon slds-icon-text-default"
    ></lightning-icon>
  </button>
</template>
<template if:false={isInputFilled}>
  <lightning-icon
    icon-name="utility:search"
    size="x-small"
    class="slds-input__icon slds-input__icon_right slds-icon-text-default"
  ></lightning-icon>
</template>

        </div>

         üîΩ Dropdown de resultados 
        <div
          if:true={isDropdownOpen}
          id="patient-listbox"
          class="slds-dropdown slds-dropdown_length-5 slds-dropdown_fluid"
          role="listbox"
        >
          <ul class="slds-listbox slds-listbox_vertical" role="presentation">
            <template if:true={patients.length}>
              <template for:each={patients} for:item="patient">
                <li key={patient.Id} class="slds-listbox__item" role="presentation">
                  <div
                    class="slds-media slds-listbox__option slds-listbox__option_entity slds-listbox__option_has-meta"
                    role="option"
                    data-id={patient.Id}
                    data-name={patient.Name}
                    onclick={handleSelect}
                  >
                    <span class="slds-media__figure slds-listbox__option-icon">
                      <lightning-icon
                        icon-name="standard:contact"
                        size="small"
                      ></lightning-icon>
                    </span>
                    <span class="slds-media__body">
                      <span class="slds-listbox__option-text slds-listbox__option-text_entity">
                        {patient.Name}
                      </span>
                      <span class="slds-listbox__option-meta">{patient.Email}</span>
                    </span>
                  </div>
                </li>
              </template>
            </template>

            üï≥Ô∏è Sin resultados 
            <template if:false={patients.length}>
              <li class="slds-listbox__item">
                <span class="slds-text-color_weak slds-p-around_x-small">
                  No results found
                </span>
              </li>
            </template>
          </ul>
        </div>
      </div>
    </div>

     ‚è≥ Spinner
    <template if:true={showLoading}>
      <div class="slds-p-top_x-small">
        <lightning-spinner
          alternative-text="Loading Patient..."
          size="small"
        ></lightning-spinner>
      </div>
    </template>
  </div>
</template> -->


<template>
  <div class="patient-container">
    <div class="slds-form-element">
      <label class="slds-form-element__label" for="patientSearch">Patient Name</label>

      <div
        class="slds-combobox_container slds-has-inline-listbox"
        aria-expanded={isDropdownOpen}
        aria-haspopup="listbox"
        role="combobox"
      >
        <div
          class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_left-right"
          role="none"
        >
          <lightning-icon
            icon-name="standard:contact"
            size="x-small"
            class="slds-input__icon slds-input__icon_left slds-icon-text-default"
          ></lightning-icon>

          <input
            type="text"
            id="patientSearch"
            class="slds-input slds-combobox__input"
            placeholder="Search Patient..."
            value={searchKey}
            oninput={handleSearchChange}
            aria-autocomplete="list"
            aria-controls="patient-listbox"
          />

          <!-- ‚ùå Clear button -->
          <template if:true={isInputFilled}>
            <button
              class="slds-button slds-button_icon slds-input__icon slds-input__icon_right slds-icon-text-default clear-btn"
              title="Clear selection"
              onclick={clearSelection}
              type="button"
              disabled={isButtonDisabled}
            >
              <lightning-icon
                icon-name="utility:close"
                size="x-small"
                class="slds-icon"
              ></lightning-icon>
            </button>
          </template>

          <!-- üîç Search icon -->
          <template if:false={isInputFilled}>
            <lightning-icon
              icon-name="utility:search"
              size="x-small"
              class="slds-input__icon slds-input__icon_right slds-icon-text-default"
            ></lightning-icon>
          </template>
        </div>

        <!-- üîΩ Dropdown -->
        <template if:true={isDropdownOpen}>
          <div
            id="patient-listbox"
            class="slds-dropdown slds-dropdown_length-5 slds-dropdown_fluid"
            role="listbox"
          >
            <ul class="slds-listbox slds-listbox_vertical" role="presentation">
              <template if:true={patients.length}>
                <template for:each={patients} for:item="patient">
                  <li key={patient.Id} class="slds-listbox__item" role="presentation">
                    <div
                      class="slds-media slds-listbox__option slds-listbox__option_entity slds-listbox__option_has-meta"
                      role="option"
                      data-id={patient.Id}
                      data-name={patient.Name}
                      onclick={handleSelect}
                    >
                      <span class="slds-media__figure slds-listbox__option-icon">
                        <lightning-icon
                          icon-name="standard:contact"
                          size="small"
                        ></lightning-icon>
                      </span>
                      <span class="slds-media__body">
                        <span class="slds-listbox__option-text slds-listbox__option-text_entity">
                          {patient.Name}
                        </span>
                        <span class="slds-listbox__option-meta">{patient.Email}</span>
                      </span>
                    </div>
                  </li>
                </template>
              </template>
              <template if:false={patients.length}>
                <li class="slds-listbox__item">
                  <span class="slds-text-color_weak slds-p-around_x-small">
                    No results found
                  </span>
                </li>
              </template>
            </ul>
          </div>
        </template>
      </div>
    </div>

    <!-- ‚è≥ Spinner -->
    <template if:true={showLoading}>
      <div class="slds-p-top_x-small">
        <lightning-spinner
          alternative-text="Loading Patient..."
          size="small"
        ></lightning-spinner>
      </div>
    </template>
  </div>
</template>